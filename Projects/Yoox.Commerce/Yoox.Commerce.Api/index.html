<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
</head>
<body>
    <h1>Ciao mondo</h1>

    <input type="text" id="clienteId" />
    <input type="button" id="myButton" value="Cerca" />

    <h2 id="cliente"></h2>

    <input type="text" id="clienteNome"/>
    <input type="text" id="clienteCognome" />
    <input type="button" id="crea" value="Crea" />
<script>
    (function () {
        "use strict";

        var button = document.getElementById('myButton');
        button.addEventListener("click", mostraCliente);

        function mostraCliente(e) {
            var id = document.getElementById('clienteId').value;

            var xh = new XMLHttpRequest();
            xh.addEventListener('readystatechange', onReadyStateChanged);

            xh.overrideMimeType('text/xml');

            xh.open("GET", "/api/clienti/" + id, true);
            xh.setRequestHeader("Accept", "text/xml");

            xh.send();
        }

        function onReadyStateChanged() {
            if (this.readyState === 4 && this.status === 200) {
                //var cliente = JSON.parse(this.responseText);

                //var h2 = document.getElementById("cliente");
                //h2.innerHTML = cliente.Nome + " " + cliente.Cognome;

                var nome = this.responseXML.getElementsByTagName("Nome")[0].childNodes[0];
                var cognome = this.responseXML.getElementsByTagName("Cognome")[0].childNodes[0];

                var h2 = document.getElementById("cliente");
                h2.innerHTML = nome.nodeValue + " " + cognome.nodeValue;
            }
        }

        button = document.getElementById('crea');
        button.addEventListener("click", creaCliente);

        function creaCliente(e) {
            var nome = document.getElementById('clienteNome').value;
            var cognome = document.getElementById('clienteCognome').value;

            var xh = new XMLHttpRequest();
            xh.addEventListener('readystatechange', xhChanged);
            xh.open('POST', "/api/clienti", true);
            xh.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xh.send(JSON.stringify({ Nome: nome, Cognome: cognome }));
        }

        function xhChanged() {
            if (this.readyState === 4 && this.status === 201) {
                alert(this.responseText);
            }
        }
    })();
</script>
</body>
</html>
